from AnalysisAlgorithmsConfig.ConfigBlock import ConfigBlock
from AnalysisAlgorithmsConfig.ConfigAccumulator import DataType

truth_branches = {
    "Ttbar" : [
        'MC_ttbar_beforeFSR_pt',
        'MC_ttbar_beforeFSR_eta',
        'MC_ttbar_beforeFSR_phi',
        'MC_ttbar_beforeFSR_m',
        'MC_ttbar_afterFSR_beforeDecay_pt',
        'MC_ttbar_afterFSR_beforeDecay_eta',
        'MC_ttbar_afterFSR_beforeDecay_phi',
        'MC_ttbar_afterFSR_beforeDecay_m',
        'MC_ttbar_afterFSR_pt',
        'MC_ttbar_afterFSR_eta',
        'MC_ttbar_afterFSR_phi',
        'MC_ttbar_afterFSR_m',
        'MC_t_beforeFSR_pt',
        'MC_t_beforeFSR_eta',
        'MC_t_beforeFSR_phi',
        'MC_t_beforeFSR_m',
        'MC_t_afterFSR_pt',
        'MC_t_afterFSR_eta',
        'MC_t_afterFSR_phi',
        'MC_t_afterFSR_m',
        'MC_W_from_t_pt',
        'MC_W_from_t_eta',
        'MC_W_from_t_phi',
        'MC_W_from_t_m',
        'MC_b_from_t_pt',
        'MC_b_from_t_eta',
        'MC_b_from_t_phi',
        'MC_b_from_t_m',
        'MC_Wdecay1_from_t_pt',
        'MC_Wdecay1_from_t_eta',
        'MC_Wdecay1_from_t_phi',
        'MC_Wdecay1_from_t_m',
        'MC_Wdecay1_from_t_pdgId',
        'MC_Wdecay2_from_t_pt',
        'MC_Wdecay2_from_t_eta',
        'MC_Wdecay2_from_t_phi',
        'MC_Wdecay2_from_t_m',
        'MC_Wdecay2_from_t_pdgId',
        'MC_tbar_beforeFSR_pt',
        'MC_tbar_beforeFSR_eta',
        'MC_tbar_beforeFSR_phi',
        'MC_tbar_beforeFSR_m',
        'MC_tbar_afterFSR_pt',
        'MC_tbar_afterFSR_eta',
        'MC_tbar_afterFSR_phi',
        'MC_tbar_afterFSR_m',
        'MC_W_from_tbar_pt',
        'MC_W_from_tbar_eta',
        'MC_W_from_tbar_phi',
        'MC_W_from_tbar_m',
        'MC_bbar_from_tbar_pt',
        'MC_bbar_from_tbar_eta',
        'MC_bbar_from_tbar_phi',
        'MC_bbar_from_tbar_m',
        'MC_Wdecay1_from_tbar_pt',
        'MC_Wdecay1_from_tbar_eta',
        'MC_Wdecay1_from_tbar_phi',
        'MC_Wdecay1_from_tbar_m',
        'MC_Wdecay1_from_tbar_pdgId',
        'MC_Wdecay2_from_tbar_pt',
        'MC_Wdecay2_from_tbar_eta',
        'MC_Wdecay2_from_tbar_phi',
        'MC_Wdecay2_from_tbar_m',
        'MC_Wdecay2_from_tbar_pdgId'
    ],
    "TtbarLight": [
        'MC_ttbar_beforeFSR_pt',
        'MC_ttbar_beforeFSR_eta',
        'MC_ttbar_beforeFSR_phi',
        'MC_ttbar_beforeFSR_m',
        'MC_ttbar_afterFSR_pt',
        'MC_ttbar_afterFSR_eta',
        'MC_ttbar_afterFSR_phi',
        'MC_ttbar_afterFSR_m',
        'MC_t_beforeFSR_pt',
        'MC_t_beforeFSR_eta',
        'MC_t_beforeFSR_phi',
        'MC_t_beforeFSR_m',
        'MC_t_afterFSR_pt',
        'MC_t_afterFSR_eta',
        'MC_t_afterFSR_phi',
        'MC_t_afterFSR_m',
        'MC_W_from_t_pt',
        'MC_W_from_t_eta',
        'MC_W_from_t_phi',
        'MC_W_from_t_m',
        'MC_q_from_t_pt',
        'MC_q_from_t_eta',
        'MC_q_from_t_phi',
        'MC_q_from_t_m',
        'MC_q_from_t_pdgId',
        'MC_Wdecay1_from_t_pt',
        'MC_Wdecay1_from_t_eta',
        'MC_Wdecay1_from_t_phi',
        'MC_Wdecay1_from_t_m',
        'MC_Wdecay1_from_t_pdgId',
        'MC_Wdecay2_from_t_pt',
        'MC_Wdecay2_from_t_eta',
        'MC_Wdecay2_from_t_phi',
        'MC_Wdecay2_from_t_m',
        'MC_Wdecay2_from_t_pdgId',
        'MC_tbar_beforeFSR_pt',
        'MC_tbar_beforeFSR_eta',
        'MC_tbar_beforeFSR_phi',
        'MC_tbar_beforeFSR_m',
        'MC_tbar_afterFSR_pt',
        'MC_tbar_afterFSR_eta',
        'MC_tbar_afterFSR_phi',
        'MC_tbar_afterFSR_m',
        'MC_W_from_tbar_pt',
        'MC_W_from_tbar_eta',
        'MC_W_from_tbar_phi',
        'MC_W_from_tbar_m',
        'MC_q_from_tbar_pt',
        'MC_q_from_tbar_eta',
        'MC_q_from_tbar_phi',
        'MC_q_from_tbar_m',
        'MC_q_from_tbar_pdgId',
        'MC_Wdecay1_from_tbar_pt',
        'MC_Wdecay1_from_tbar_eta',
        'MC_Wdecay1_from_tbar_phi',
        'MC_Wdecay1_from_tbar_m',
        'MC_Wdecay1_from_tbar_pdgId',
        'MC_Wdecay2_from_tbar_pt',
        'MC_Wdecay2_from_tbar_eta',
        'MC_Wdecay2_from_tbar_phi',
        'MC_Wdecay2_from_tbar_m',
        'MC_Wdecay2_from_tbar_pdgId'
    ],
    "Ttz" : [
        'MC_ttbar_beforeFSR_pt',
        'MC_ttbar_beforeFSR_eta',
        'MC_ttbar_beforeFSR_phi',
        'MC_ttbar_beforeFSR_m',
        'MC_ttbar_afterFSR_beforeDecay_pt',
        'MC_ttbar_afterFSR_beforeDecay_eta',
        'MC_ttbar_afterFSR_beforeDecay_phi',
        'MC_ttbar_afterFSR_beforeDecay_m',
        'MC_ttbar_afterFSR_pt',
        'MC_ttbar_afterFSR_eta',
        'MC_ttbar_afterFSR_phi',
        'MC_ttbar_afterFSR_m',
        'MC_t_beforeFSR_pt',
        'MC_t_beforeFSR_eta',
        'MC_t_beforeFSR_phi',
        'MC_t_beforeFSR_m',
        'MC_t_afterFSR_pt',
        'MC_t_afterFSR_eta',
        'MC_t_afterFSR_phi',
        'MC_t_afterFSR_m',
        'MC_W_from_t_pt',
        'MC_W_from_t_eta',
        'MC_W_from_t_phi',
        'MC_W_from_t_m',
        'MC_b_from_t_pt',
        'MC_b_from_t_eta',
        'MC_b_from_t_phi',
        'MC_b_from_t_m',
        'MC_Wdecay1_from_t_pt',
        'MC_Wdecay1_from_t_eta',
        'MC_Wdecay1_from_t_phi',
        'MC_Wdecay1_from_t_m',
        'MC_Wdecay1_from_t_pdgId',
        'MC_Wdecay2_from_t_pt',
        'MC_Wdecay2_from_t_eta',
        'MC_Wdecay2_from_t_phi',
        'MC_Wdecay2_from_t_m',
        'MC_Wdecay2_from_t_pdgId',
        'MC_tbar_beforeFSR_pt',
        'MC_tbar_beforeFSR_eta',
        'MC_tbar_beforeFSR_phi',
        'MC_tbar_beforeFSR_m',
        'MC_tbar_afterFSR_pt',
        'MC_tbar_afterFSR_eta',
        'MC_tbar_afterFSR_phi',
        'MC_tbar_afterFSR_m',
        'MC_W_from_tbar_pt',
        'MC_W_from_tbar_eta',
        'MC_W_from_tbar_phi',
        'MC_W_from_tbar_m',
        'MC_bbar_from_tbar_pt',
        'MC_bbar_from_tbar_eta',
        'MC_bbar_from_tbar_phi',
        'MC_bbar_from_tbar_m',
        'MC_Wdecay1_from_tbar_pt',
        'MC_Wdecay1_from_tbar_eta',
        'MC_Wdecay1_from_tbar_phi',
        'MC_Wdecay1_from_tbar_m',
        'MC_Wdecay1_from_tbar_pdgId',
        'MC_Wdecay2_from_tbar_pt',
        'MC_Wdecay2_from_tbar_eta',
        'MC_Wdecay2_from_tbar_phi',
        'MC_Wdecay2_from_tbar_m',
        'MC_Wdecay2_from_tbar_pdgId',
        'MC_Z_pt',
        'MC_Z_eta',
        'MC_Z_phi',
        'MC_Z_m',
        'MC_Zdecay1_pt',
        'MC_Zdecay1_eta',
        'MC_Zdecay1_phi',
        'MC_Zdecay1_m',
        'MC_Zdecay1_pdgId',
        'MC_Zdecay2_pt',
        'MC_Zdecay2_eta',
        'MC_Zdecay2_phi',
        'MC_Zdecay2_m',
        'MC_Zdecay2_pdgId',
        'MC_Z_IsOnShell'
    ],
    "Tth" : [
        'MC_ttbar_beforeFSR_pt',
        'MC_ttbar_beforeFSR_eta',
        'MC_ttbar_beforeFSR_phi',
        'MC_ttbar_beforeFSR_m',
        'MC_ttbar_afterFSR_beforeDecay_pt',
        'MC_ttbar_afterFSR_beforeDecay_eta',
        'MC_ttbar_afterFSR_beforeDecay_phi',
        'MC_ttbar_afterFSR_beforeDecay_m',
        'MC_ttbar_afterFSR_pt',
        'MC_ttbar_afterFSR_eta',
        'MC_ttbar_afterFSR_phi',
        'MC_ttbar_afterFSR_m',
        'MC_t_beforeFSR_pt',
        'MC_t_beforeFSR_eta',
        'MC_t_beforeFSR_phi',
        'MC_t_beforeFSR_m',
        'MC_t_afterFSR_pt',
        'MC_t_afterFSR_eta',
        'MC_t_afterFSR_phi',
        'MC_t_afterFSR_m',
        'MC_W_from_t_pt',
        'MC_W_from_t_eta',
        'MC_W_from_t_phi',
        'MC_W_from_t_m',
        'MC_b_from_t_pt',
        'MC_b_from_t_eta',
        'MC_b_from_t_phi',
        'MC_b_from_t_m',
        'MC_Wdecay1_from_t_pt',
        'MC_Wdecay1_from_t_eta',
        'MC_Wdecay1_from_t_phi',
        'MC_Wdecay1_from_t_m',
        'MC_Wdecay1_from_t_pdgId',
        'MC_Wdecay2_from_t_pt',
        'MC_Wdecay2_from_t_eta',
        'MC_Wdecay2_from_t_phi',
        'MC_Wdecay2_from_t_m',
        'MC_Wdecay2_from_t_pdgId',
        'MC_tbar_beforeFSR_pt',
        'MC_tbar_beforeFSR_eta',
        'MC_tbar_beforeFSR_phi',
        'MC_tbar_beforeFSR_m',
        'MC_tbar_afterFSR_pt',
        'MC_tbar_afterFSR_eta',
        'MC_tbar_afterFSR_phi',
        'MC_tbar_afterFSR_m',
        'MC_W_from_tbar_pt',
        'MC_W_from_tbar_eta',
        'MC_W_from_tbar_phi',
        'MC_W_from_tbar_m',
        'MC_bbar_from_tbar_pt',
        'MC_bbar_from_tbar_eta',
        'MC_bbar_from_tbar_phi',
        'MC_bbar_from_tbar_m',
        'MC_Wdecay1_from_tbar_pt',
        'MC_Wdecay1_from_tbar_eta',
        'MC_Wdecay1_from_tbar_phi',
        'MC_Wdecay1_from_tbar_m',
        'MC_Wdecay1_from_tbar_pdgId',
        'MC_Wdecay2_from_tbar_pt',
        'MC_Wdecay2_from_tbar_eta',
        'MC_Wdecay2_from_tbar_phi',
        'MC_Wdecay2_from_tbar_m',
        'MC_Wdecay2_from_tbar_pdgId',
        'MC_Higgs_pt',
        'MC_Higgs_eta',
        'MC_Higgs_phi',
        'MC_Higgs_m',
        'MC_Higgs_decay1_pt',
        'MC_Higgs_decay1_eta',
        'MC_Higgs_decay1_phi',
        'MC_Higgs_decay1_m',
        'MC_Higgs_decay1_pdgId',
        'MC_Higgs_decay2_pt',
        'MC_Higgs_decay2_eta',
        'MC_Higgs_decay2_phi',
        'MC_Higgs_decay2_m',
        'MC_Higgs_decay2_pdgId',
        'MC_Higgs_decay1_from_decay1_pt',
        'MC_Higgs_decay1_from_decay1_eta',
        'MC_Higgs_decay1_from_decay1_phi',
        'MC_Higgs_decay1_from_decay1_m',
        'MC_Higgs_decay1_from_decay1_pdgId',
        'MC_Higgs_decay2_from_decay1_pt',
        'MC_Higgs_decay2_from_decay1_eta',
        'MC_Higgs_decay2_from_decay1_phi',
        'MC_Higgs_decay2_from_decay1_m',
        'MC_Higgs_decay2_from_decay1_pdgId',
        'MC_Higgs_decay1_from_decay2_pt',
        'MC_Higgs_decay1_from_decay2_eta',
        'MC_Higgs_decay1_from_decay2_phi',
        'MC_Higgs_decay1_from_decay2_m',
        'MC_Higgs_decay1_from_decay2_pdgId',
        'MC_Higgs_decay2_from_decay2_pt',
        'MC_Higgs_decay2_from_decay2_eta',
        'MC_Higgs_decay2_from_decay2_phi',
        'MC_Higgs_decay2_from_decay2_m',
        'MC_Higgs_decay2_from_decay2_pdgId',
    ],
    "Tzq" : [
        "MC_t_beforeFSR_m",
        "MC_t_beforeFSR_pt",
        "MC_t_beforeFSR_eta",
        "MC_t_beforeFSR_phi",
        "MC_t_afterFSR_m",
        "MC_t_afterFSR_pt",
        "MC_t_afterFSR_eta",
        "MC_t_afterFSR_phi",
        "MC_tbar_beforeFSR_m",
        "MC_tbar_beforeFSR_pt",
        "MC_tbar_beforeFSR_eta",
        "MC_tbar_beforeFSR_phi",
        "MC_tbar_afterFSR_m",
        "MC_tbar_afterFSR_pt",
        "MC_tbar_afterFSR_eta",
        "MC_tbar_afterFSR_phi",
        "MC_W_from_t_m",
        "MC_W_from_t_pt",
        "MC_W_from_t_eta",
        "MC_W_from_t_phi",
        "MC_W_from_tbar_m",
        "MC_W_from_tbar_pt",
        "MC_W_from_tbar_eta",
        "MC_W_from_tbar_phi",
        "MC_b_from_t_m",
        "MC_b_from_t_pt",
        "MC_b_from_t_eta",
        "MC_b_from_t_phi",
        "MC_bbar_from_tbar_m",
        "MC_bbar_from_tbar_pt",
        "MC_bbar_from_tbar_eta",
        "MC_bbar_from_tbar_phi",
        "MC_Wdecay1_from_t_m",
        "MC_Wdecay1_from_t_pt",
        "MC_Wdecay1_from_t_eta",
        "MC_Wdecay1_from_t_phi",
        "MC_Wdecay1_from_t_pdgId",
        "MC_Wdecay2_from_t_m",
        "MC_Wdecay2_from_t_pt",
        "MC_Wdecay2_from_t_eta",
        "MC_Wdecay2_from_t_phi",
        "MC_Wdecay2_from_t_pdgId",
        "MC_Wdecay1_from_tbar_m",
        "MC_Wdecay1_from_tbar_pt",
        "MC_Wdecay1_from_tbar_eta",
        "MC_Wdecay1_from_tbar_phi",
        "MC_Wdecay1_from_tbar_pdgId",
        "MC_Wdecay2_from_tbar_m",
        "MC_Wdecay2_from_tbar_pt",
        "MC_Wdecay2_from_tbar_eta",
        "MC_Wdecay2_from_tbar_phi",
        "MC_Wdecay2_from_tbar_pdgId",
        "MC_Z_m",
        "MC_Z_pt",
        "MC_Z_eta",
        "MC_Z_phi",
        "MC_Zdecay1_m",
        "MC_Zdecay1_pt",
        "MC_Zdecay1_eta",
        "MC_Zdecay1_phi",
        "MC_Zdecay1_pdgId",
        "MC_Zdecay1_status",
        "MC_Zdecay2_m",
        "MC_Zdecay2_pt",
        "MC_Zdecay2_eta",
        "MC_Zdecay2_phi",
        "MC_Zdecay2_pdgId",
        "MC_Zdecay2_status",
        "MC_b_m",
        "MC_b_pt",
        "MC_b_eta",
        "MC_b_phi",
        "MC_b_pdgId",
        "MC_bbar_m",
        "MC_bbar_pt",
        "MC_bbar_eta",
        "MC_bbar_phi",
        "MC_bbar_pdgId",
        "MC_q_m",
        "MC_q_pt",
        "MC_q_eta",
        "MC_q_phi",
        "MC_q_pdgId",
        "MC_qbar_m",
        "MC_qbar_pt",
        "MC_qbar_eta",
        "MC_qbar_phi",
        "MC_qbar_pdgId",
    ],
    "HWW" : [
        'MC_H_pt',
        'MC_H_eta',
        'MC_H_phi',
        'MC_H_m',
        'MC_Wm_from_H_pt',
        'MC_Wm_from_H_eta',
        'MC_Wm_from_H_phi',
        'MC_Wm_from_H_m',
        'MC_Wp_from_H_pt',
        'MC_Wp_from_H_eta',
        'MC_Wp_from_H_phi',
        'MC_Wp_from_H_m',
        'MC_WmDecay1_from_H_pt',
        'MC_WmDecay1_from_H_eta',
        'MC_WmDecay1_from_H_phi',
        'MC_WmDecay1_from_H_m',
        'MC_WmDecay1_from_H_pdgId',
        'MC_WmDecay2_from_H_pt',
        'MC_WmDecay2_from_H_eta',
        'MC_WmDecay2_from_H_phi',
        'MC_WmDecay2_from_H_m',
        'MC_WmDecay2_from_H_pdgId',
        'MC_WpDecay1_from_H_pt',
        'MC_WpDecay1_from_H_eta',
        'MC_WpDecay1_from_H_phi',
        'MC_WpDecay1_from_H_m',
        'MC_WpDecay1_from_H_pdgId',
        'MC_WpDecay2_from_H_pt',
        'MC_WpDecay2_from_H_eta',
        'MC_WpDecay2_from_H_phi',
        'MC_WpDecay2_from_H_m',
        'MC_WpDecay2_from_H_pdgId'
        ]
}

class truthConfig(ConfigBlock):
    """ConfigBlock for truth/parton-level objects"""

    def __init__(self):
        super(truthConfig, self).__init__()
        self.addOption('histories', None, type=str)

    def makeAlgs(self, config):

        if config.dataType() is DataType.Data: return

        # loop over all histories
        for history in self.getPartonHistories():
            alg = config.createAlgorithm("top::RunPartonHistoryAlg", "PartonHistory" + history)
            alg.partonScheme = history
            container = "PartonHistory" + history
            _ = config.writeName(container)

            for branch in truth_branches[history]:
                config.addOutputVar(container, branch, branch, noSys=True)

    def getPartonHistories(self):
        # parton histories can be provided as History1.History2.etc
        return self.histories.split(".")

    def getOutputContainers(self):
        # return a dictionary of containers that can be added to the OutputAnalysisConfig
        containerDict = {}
        for history in self.getPartonHistories():
            containerDict[history + '_'] = 'PartonHistory' + history
        return containerDict
